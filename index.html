<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Remote PC Control</title>
<style>
  body {
    background: #111;
    color: white;
    font-family: sans-serif;
    text-align: center;
    margin: 0; padding: 10px;
    user-select: none;
  }
  #screen {
    width: 100vw;
    max-width: 1280px;
    border: 2px solid #444;
    touch-action: none;
  }
  #auth input, #auth button,
  #controls button {
    font-size: 1.2em;
    padding: 8px;
    margin: 8px 4px;
    border-radius: 4px;
    border: none;
  }
  #status {
    margin: 10px 0;
    height: 1.5em;
  }
  #hiddenInput {
    position: fixed;
    top: 10px; left: 10px;
    opacity: 0;
    height: 1px;
    width: 1px;
    caret-color: transparent; /* –°–∫—Ä—ã—Ç—å –∫—É—Ä—Å–æ—Ä */
  }
</style>
</head>
<body>

<h2>üì∫ –ü—Ä—è–º–æ–π —ç–∫—Ä–∞–Ω</h2>

<!-- –≠–∫—Ä–∞–Ω -->
<img id="screen" src="" alt="Screen" />

<!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
<div id="auth">
  <input id="passwordInput" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="off" />
  <button id="loginBtn">–í–æ–π—Ç–∏</button>
  <div id="status"></div>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div id="controls" style="display:none;">
  <button id="backspaceBtn">Backspace</button>
</div>

<!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã -->
<input id="hiddenInput" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />

<script>
(() => {
  const wsUrl = "wss://54bc-176-7-134-177.ngrok-free.app"; // –ü–æ–º–µ–Ω—è–π –Ω–∞ —Å–≤–æ–π –∞–¥—Ä–µ—Å
  let ws;
  let authorized = false;

  const screen = document.getElementById("screen");
  const passwordInput = document.getElementById("passwordInput");
  const loginBtn = document.getElementById("loginBtn");
  const statusDiv = document.getElementById("status");
  const authDiv = document.getElementById("auth");
  const controlsDiv = document.getElementById("controls");
  const backspaceBtn = document.getElementById("backspaceBtn");
  const hiddenInput = document.getElementById("hiddenInput");

  function connect() {
    ws = new WebSocket(wsUrl);

    ws.onopen = () => {
      statusDiv.textContent = "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å.";
    };

    ws.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      if (!authorized) {
        if (msg.type === "auth" && msg.status === "ok") {
          authorized = true;
          statusDiv.textContent = "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!";
          authDiv.style.display = "none";
          controlsDiv.style.display = "block";
          hiddenInput.value = "";
          hiddenInput.focus();
        } else if (msg.type === "auth" && msg.status === "fail") {
          statusDiv.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.";
        }
        return;
      }

      if (msg.type === "screen") {
        screen.src = "data:image/jpeg;base64," + msg.data;
      }
    };

    ws.onclose = () => {
      statusDiv.textContent = "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.";
      authDiv.style.display = "block";
      controlsDiv.style.display = "none";
      authorized = false;
    };

    ws.onerror = () => {
      statusDiv.textContent = "–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.";
    };
  }

  loginBtn.onclick = () => {
    if (ws.readyState === WebSocket.OPEN) {
      const pass = passwordInput.value.trim();
      if (pass.length === 0) {
        statusDiv.textContent = "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å.";
        return;
      }
      ws.send(JSON.stringify({ type: "auth", password: pass }));
    }
  };

  // –ö–ª–∏–∫ –ø–æ —ç–∫—Ä–∞–Ω—É ‚Äî —Ñ–æ–∫—É—Å –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ (–≤—ã–∑–æ–≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã)
  screen.addEventListener('click', () => {
    if (authorized) hiddenInput.focus();
  });

  // –ü—Ä–∏ –≤–≤–æ–¥–µ –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∏ –æ—á–∏—â–∞–µ–º –ø–æ–ª–µ
  hiddenInput.addEventListener('input', () => {
    if (!authorized) return;
    const val = hiddenInput.value;
    if (val.length > 0) {
      ws.send(JSON.stringify({ type: "type", text: val }));
      hiddenInput.value = '';
    }
  });

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ backspace —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
  hiddenInput.addEventListener('keydown', (e) => {
    if (!authorized) return;
    if (e.key === "Backspace") {
      ws.send(JSON.stringify({ type: "backspace" }));
      e.preventDefault();
    }
  });

  // –ö–Ω–æ–ø–∫–∞ Backspace
  backspaceBtn.onclick = () => {
    if (!authorized) return;
    ws.send(JSON.stringify({ type: "backspace" }));
    hiddenInput.focus();
  };

  // –°–∫—Ä–æ–ª–ª —Å–≤–∞–π–ø–æ–º
  let lastTouchY = null;
  screen.addEventListener("touchstart", (e) => {
    lastTouchY = e.touches[0].clientY;
  }, { passive: false });

  screen.addEventListener("touchmove", (e) => {
    if (!authorized) return;
    let currentY = e.touches[0].clientY;
    let dy = lastTouchY - currentY;
    lastTouchY = currentY;
    ws.send(JSON.stringify({ type: "scroll", dy: Math.round(dy * 10) }));
    e.preventDefault();
  }, { passive: false });

  connect();
})();
</script>

</body>
</html>
