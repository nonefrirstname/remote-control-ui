<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Remote PC Control</title>
<style>
  body {
    background: #111;
    color: white;
    font-family: sans-serif;
    text-align: center;
    margin: 0; padding: 10px;
    user-select: none;
  }
  #screen {
    width: 100vw;
    max-width: 1280px;
    border: 2px solid #444;
    touch-action: none;
  }
  input, button {
    font-size: 1.2em;
    padding: 8px;
    margin: 8px 4px;
    border-radius: 4px;
    border: none;
  }
  #controls {
    margin-top: 10px;
  }
  #status {
    margin: 10px 0;
    height: 1.5em;
  }
</style>
</head>
<body>

<h2>üì∫ –ü—Ä—è–º–æ–π —ç–∫—Ä–∞–Ω</h2>

<!-- –≠–∫—Ä–∞–Ω -->
<img id="screen" src="" alt="Screen" />

<!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
<div id="auth">
  <input id="passwordInput" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="off" />
  <button id="loginBtn">–í–æ–π—Ç–∏</button>
  <div id="status"></div>
</div>

<!-- –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ -->
<div id="textContainer" style="display:none;">
  <input id="textInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ Enter" autocomplete="off" />
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div id="controls" style="display:none;">
  <button id="backspaceBtn">Backspace</button>
</div>

<script>
(() => {
  const wsUrl = "wss://815c-176-7-134-177.ngrok-free.app"; // –ü–æ–º–µ–Ω—è–π –Ω–∞ —Å–≤–æ–π ngrok –∞–¥—Ä–µ—Å
  let ws;
  let authorized = false;

  const screen = document.getElementById("screen");
  const passwordInput = document.getElementById("passwordInput");
  const loginBtn = document.getElementById("loginBtn");
  const statusDiv = document.getElementById("status");
  const authDiv = document.getElementById("auth");
  const textContainer = document.getElementById("textContainer");
  const textInput = document.getElementById("textInput");
  const controlsDiv = document.getElementById("controls");
  const backspaceBtn = document.getElementById("backspaceBtn");

  function connect() {
    ws = new WebSocket(wsUrl);

    ws.onopen = () => {
      statusDiv.textContent = "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å.";
    };

    ws.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      if (!authorized) {
        if (msg.type === "auth" && msg.status === "ok") {
          authorized = true;
          statusDiv.textContent = "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!";
          authDiv.style.display = "none";
          textContainer.style.display = "block";
          controlsDiv.style.display = "block";
        } else if (msg.type === "auth" && msg.status === "fail") {
          statusDiv.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.";
        }
        return;
      }

      if (msg.type === "screen") {
        screen.src = "data:image/jpeg;base64," + msg.data;
      }
    };

    ws.onclose = () => {
      statusDiv.textContent = "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.";
      authDiv.style.display = "block";
      textContainer.style.display = "none";
      controlsDiv.style.display = "none";
      authorized = false;
    };

    ws.onerror = (e) => {
      statusDiv.textContent = "–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.";
    };
  }

  loginBtn.onclick = () => {
    if (ws.readyState === WebSocket.OPEN) {
      const pass = passwordInput.value.trim();
      if (pass.length === 0) {
        statusDiv.textContent = "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å.";
        return;
      }
      ws.send(JSON.stringify({ type: "auth", password: pass }));
    }
  };

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∏–∫–∞
  screen.onclick = (e) => {
    if (!authorized) return;
    const rect = screen.getBoundingClientRect();
    const x = Math.round((e.clientX - rect.left) * 1280 / screen.clientWidth);
    const y = Math.round((e.clientY - rect.top) * 720 / screen.clientHeight);
    ws.send(JSON.stringify({ type: "click", x, y }));
  };

  // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞
  textInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && authorized) {
      const text = textInput.value;
      if (text.length > 0) {
        ws.send(JSON.stringify({ type: "type", text: text }));
        textInput.value = "";
      }
    }
  });

  // –°–∫—Ä–æ–ª–ª–∏–Ω–≥ –ø–æ —Å–≤–∞–π–ø—É
  let lastTouchY = null;
  screen.addEventListener("touchstart", (e) => {
    lastTouchY = e.touches[0].clientY;
  }, { passive: false });

  screen.addEventListener("touchmove", (e) => {
    if (!authorized) return;
    let currentY = e.touches[0].clientY;
    let dy = lastTouchY - currentY;
    lastTouchY = currentY;
    ws.send(JSON.stringify({ type: "scroll", dy: dy * 10 }));
    e.preventDefault();
  }, { passive: false });

  // –ö–Ω–æ–ø–∫–∞ backspace
  backspaceBtn.onclick = () => {
    if (!authorized) return;
    ws.send(JSON.stringify({ type: "backspace" }));
  };

  connect();
})();
</script>

</body>
</html>
